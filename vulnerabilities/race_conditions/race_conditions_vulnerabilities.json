{
    "metadata": {
        "category": "Race Conditions",
        "version": "1.0.0",
        "last_updated": "2025-02-22T06:50:00Z",
        "description": "Race condition vulnerabilities in Android applications including file system, shared preferences, and IPC-related race conditions"
    },
    "vulnerabilities": [
        {
            "id": "RACE-001",
            "name": "File System Race Condition",
            "description": "Application performs file operations without proper synchronization, allowing time-of-check to time-of-use (TOCTOU) attacks.",
            "severity": {
                "level": "High",
                "impact": "File manipulation, data corruption, and privilege escalation",
                "exploitability": "Medium"
            },
            "detection": {
                "pattern": [
                    "File\\.exists\\([^)]+\\)[^;]*File\\.(create|write|delete)",
                    "!File\\.exists\\([^)]+\\)[^;]*new FileOutputStream",
                    "if\\s*\\([^)]*exists\\(\\)[^{]*\\)\\s*\\{[^}]*write",
                    "checkFile[^{]*\\{[^}]*writeFile"
                ],
                "method": "static",
                "indicators": [
                    "File existence check",
                    "File creation/modification",
                    "Unsynchronized operations",
                    "TOCTOU pattern"
                ],
                "accuracy_improvements": {
                    "required_conditions": [
                        "File operations present",
                        "Existence checking",
                        "Write operations"
                    ],
                    "exclusion_patterns": [
                        "synchronized\\s*\\(",
                        "FileLock",
                        "AtomicFile"
                    ],
                    "validation_steps": [
                        "Check synchronization",
                        "Analyze file operations",
                        "Review thread safety",
                        "Verify atomic operations"
                    ],
                    "context_requirements": [
                        "File system access",
                        "Multi-threaded environment"
                    ]
                },
                "confidence_score": {
                    "static_analysis": 85,
                    "dynamic_analysis": 90,
                    "manual_review": 95
                }
            },
            "exploit": {
                "difficulty": "Medium",
                "steps": [
                    "Identify race window",
                    "Create parallel threads",
                    "Time file operations",
                    "Exploit check-use gap",
                    "Manipulate target file"
                ],
                "requirements": [
                    "File system access",
                    "Multi-threading capability",
                    "Timing precision"
                ],
                "verification": {
                    "test_cases": [
                        "Parallel file access",
                        "Rapid file operations",
                        "State manipulation"
                    ],
                    "expected_results": [
                        "Race condition triggered",
                        "File corrupted/modified",
                        "Operation intercepted"
                    ]
                }
            },
            "affected_components": [
                "File operations",
                "Storage access",
                "Thread management"
            ],
            "tags": [
                "race-condition",
                "file-system",
                "toctou",
                "concurrency"
            ]
        },
        {
            "id": "RACE-002",
            "name": "Shared Preferences Race Condition",
            "description": "Application accesses SharedPreferences without proper synchronization, enabling data corruption and preference manipulation attacks.",
            "severity": {
                "level": "High",
                "impact": "Preference manipulation, data corruption, and security bypass",
                "exploitability": "Medium"
            },
            "detection": {
                "pattern": [
                    "getSharedPreferences\\([^)]+\\)\\.edit\\(\\)",
                    "PreferenceManager\\.getDefaultSharedPreferences\\([^)]+\\)",
                    "SharedPreferences\\.Editor\\s+[^;]+;[^.]*\\.commit\\(\\)",
                    "(?<!synchronized)\\s+edit\\(\\)\\.put[^;]+commit\\(\\)"
                ],
                "method": "static",
                "indicators": [
                    "Preference modification",
                    "Editor usage",
                    "Commit operations",
                    "Unsynchronized access"
                ],
                "accuracy_improvements": {
                    "required_conditions": [
                        "SharedPreferences usage",
                        "Editor operations",
                        "Preference modification"
                    ],
                    "exclusion_patterns": [
                        "synchronized\\s*\\(",
                        "\\.apply\\(\\)",
                        "AtomicReference"
                    ],
                    "validation_steps": [
                        "Check synchronization",
                        "Analyze editor usage",
                        "Review commit calls",
                        "Verify thread safety"
                    ],
                    "context_requirements": [
                        "Preference modification",
                        "Multi-threaded access"
                    ]
                },
                "confidence_score": {
                    "static_analysis": 90,
                    "dynamic_analysis": 85,
                    "manual_review": 95
                }
            },
            "exploit": {
                "difficulty": "Medium",
                "steps": [
                    "Identify preference access",
                    "Create parallel threads",
                    "Time modifications",
                    "Exploit race window",
                    "Corrupt preferences"
                ],
                "requirements": [
                    "SharedPreferences access",
                    "Multi-threading capability",
                    "Timing control"
                ],
                "verification": {
                    "test_cases": [
                        "Parallel preference access",
                        "Rapid modifications",
                        "Commit timing"
                    ],
                    "expected_results": [
                        "Race condition triggered",
                        "Preferences corrupted",
                        "Data inconsistency"
                    ]
                }
            },
            "affected_components": [
                "SharedPreferences",
                "Preference storage",
                "Data consistency"
            ],
            "tags": [
                "race-condition",
                "preferences",
                "concurrency",
                "data-corruption"
            ]
        }
    ]
}